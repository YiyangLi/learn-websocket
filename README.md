# Learn Websocket

## Requirements

Build a simple chat application using Redis.
[ ] Build a websocket server in node that publishes messages to and subscribes messages from Redis
[ ] Add an HAProxy for layer-7 Load Balancer
[ ] Include the redis, HAProxy and N web servers in a docker-compose file.
[ ] Build a sample client that could send massive messages, each message is randomly generated.
[ ] Build a helm chart, so that it can be deployed to k8s and the size of web servers, N, is dynamic.

## Technical details

### Limitation
In version 1, I will only focus on real time messenging, websocket and redis' pub-sub feature. It doesn't come with the following features.

- No Login, no identity, no friendship. Anyone who can access to the servers can join the chat, message to anyone or any group.
- Historical messages. When a client is offline, and misses the messages in a 1:1 chat or a group chat. They can't get the messages back. 
- Messages Synchronization. When a client joins the server, old messages are not replayed. However, if multiple clients join using the same username, they all will receive the messages delivered to the user. Since there's no authentication, it is an eavesdropping.
- When a server dies, clients have to join again. The HAProxy is not as smart as zookeeper, who can assign a new server to clients.
- Users don't know if the destination is online or not. A message is possibly published to a channel without subscribers.

### Server

### Client
Each client comes with a username, a 1:1 chat refers to a channel id generated by 2 users' username. The two users are sorted alphabetically, and the channel id will become `${largerName}_${smallerName}`. The channel id will become the channel used to publish and subscribe a message. Channels in Redis' pub-sub are similar to topics in Kafka.

For a group chat, the group name is the channel id. If a client joins a group, it starts to subscribe messages sent to the group. Historical messages are not replayed.

### Storage
Redis is used here, but only for pub-sub purposes. Though messages are stored, the search feature is not implemented in the very first version.

## References
- [ByteByteGo EP18: Build a chat application.](https://blog.bytebytego.com/p/ep18-build-a-chat-application-also)
- [Hussein Nasser: Scaling Websockets with Redis, HAProxy and Node JS - High-availability Group Chat Application](https://www.youtube.com/watch?v=gzIcGhJC8hA)

